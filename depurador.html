<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Depurador de Extração de PDF</title>
    <style>
        body { 
            font-family: sans-serif; 
            display: flex; 
            align-items: center; 
            min-height: 100vh; 
            flex-direction: column; 
            padding: 20px 0;
            box-sizing: border-box;
        }
        #pdf-upload { display: none; }
        label { 
            background-color: #007bff; 
            color: white; 
            padding: 15px 25px; 
            border-radius: 5px; 
            cursor: pointer; 
            font-size: 1.2em;
        }
        #loading { margin-top: 20px; font-size: 1.1em; }

        /* --- NOVO CSS --- */
        #transcricao-container {
            width: 80%;
            max-width: 800px;
            margin-top: 20px;
            text-align: left;
        }
        #transcricao {
            border: 1px solid #ccc;
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 5px;
            height: 500px; /* Altura fixa */
            overflow-y: auto; /* Barra de rolagem vertical */
            white-space: pre-wrap; /* Preserva quebras de linha e espaços */
            font-family: monospace;
            line-height: 1.5;
        }
    </style>
</head>
<body>

    <input type="file" id="pdf-upload" accept=".pdf">
    <label for="pdf-upload">Clique aqui para carregar o PDF e depurar</label>
    <p id="loading" style="display:none;">Analisando o texto do PDF...</p>

    <div id="transcricao-container">
        <h3 style="text-align: center;">Transcrição</h3>
        <div id="transcricao"></div>
    </div>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>
    <script>
        // Configuração do worker para a biblioteca
        pdfjsLib.GlobalWorkerOptions.workerSrc = `https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.worker.min.js`;

        // --- JAVASCRIPT MODIFICADO ---
        const loadingEl = document.getElementById("loading");
        const outputEl = document.getElementById("transcricao"); // Pega a nova div

        document.getElementById("pdf-upload").addEventListener("change", async function(event) {
            const file = event.target.files[0];
            if (!file) return;

            loadingEl.style.display = "block";
            outputEl.textContent = ""; // Limpa resultados anteriores

            const fileReader = new FileReader();
            fileReader.onload = async function() {
                try {
                    const typedarray = new Uint8Array(this.result);
                    const pdf = await pdfjsLib.getDocument(typedarray).promise;
                    let fullText = '';
                    
                    // Itera por todas as páginas do PDF
                    for (let i = 1; i <= pdf.numPages; i++) {
                        loadingEl.textContent = `Analisando página ${i}/${pdf.numPages}...`;
                        const page = await pdf.getPage(i);
                        const textContent = await page.getTextContent();
                        
                        // Junta os itens de texto com quebra de linha para preservar a estrutura
                        const pageText = textContent.items.map(item => item.str).join('\n');
                        fullText += pageText + '\n\n--- FIM DA PÁGINA ' + i + ' ---\n\n';
                    }

                    // Exibe o resultado na DIV
                    outputEl.textContent = fullText;
                    
                    // Remove o console.log e o alert
                    console.log("Texto extraído com sucesso e exibido na página.");


                } catch (error) {
                    console.error("Erro ao processar o PDF:", error);
                    outputEl.textContent = "Ocorreu um erro ao ler o arquivo PDF. Verifique o console (F12).";
                } finally {
                    loadingEl.style.display = "none";
                    loadingEl.textContent = "Analisando o texto do PDF..."; // Reseta o texto
                }
            };
            fileReader.readAsArrayBuffer(file);
        });
    </script>
</body>
</html>